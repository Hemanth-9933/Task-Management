<div class="project-container" *ngIf="project">

  <div *ngIf="currentPage === 'createTask'" class="form-page">

    <div class="page-header">
      <h2>Create Task</h2>
    </div>

    <div class="form-card">
      <div class="form-grid">

        <div class="form-group">
          <label>Title *</label>
          <input type="text" [(ngModel)]="newTask.title">
        </div>

        <div class="form-group">
          <label>Status *</label>
          <select [(ngModel)]="newTask.status">
            <option>To Do</option>
            <option>In Progress</option>
            <option>Completed</option>
            <option>Overdue</option>
          </select>
        </div>

        <div class="form-group">
          <label>Priority *</label>
          <select [(ngModel)]="newTask.priority">

            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
            <option>Urgent</option>
          </select>
        </div>

        <div class="form-group">
          <label>Assignee *</label>
          <input type="text" [(ngModel)]="newTask.assignee">
        </div>

        <div class="form-group">
          <label>Due Date *</label>
          <input type="date" [(ngModel)]="newTask.dueDate">
        </div>

        <div class="form-group full">
          <label>Description</label>
          <textarea [(ngModel)]="newTask.description" required></textarea>
        </div>

      </div>

      <div class="form-actions">
        <button class="btn green" (click)="saveTask()">Create Task</button>
        <button class="btn outline" (click)="showMain()">Cancel</button>
      </div>
    </div>
  </div>

  <div *ngIf="currentPage === 'editProject'" class="form-page">

    <div class="page-header">
      <h2>Edit Project</h2>
    </div>

    <div class="form-card">
      <div class="form-grid">

        <div class="form-group">
          <label>Project Name *</label>
          <input type="text" [(ngModel)]="project.title">
        </div>

        <div class="form-group">
          <label>Status *</label>
          <select [(ngModel)]="project.status">
            <option>To Do</option>
            <option>In Progress</option>
            <option>Completed</option>
            <option>Overdue</option>
          </select>
        </div>

        <div class="form-group">
          <label>Start Date *</label>
          <input type="date" [(ngModel)]="project.startDate">
        </div>

        <div class="form-group">
          <label>End Date *</label>
          <input type="date" [(ngModel)]="project.endDate">
        </div>

        <div class="form-group full">
          <label>Description</label>
          <textarea [(ngModel)]="project.desc"></textarea>
        </div>

      </div>

      <div class="form-actions">
        <button class="btn green" (click)="saveProject()">Save Changes</button>
        <button class="btn outline" (click)="showMain()">Cancel</button>
      </div>
    </div>
  </div>

  <div *ngIf="currentPage === 'main'">

    <div class="project-header">

      <div class="header-left">

        <div class="edit-btn-wrapper">
          <button class="btn outline edit-btn"
                  (click)="openEditProject()">
            ‚úè Edit Project
          </button>
        </div>

        <h1 class="project-title">
          {{ project.title }}
          <span class="status-badge"
                [ngClass]="project.status?.replace(' ','').toLowerCase()">
            {{ project.status }}
          </span>
        </h1>

        <p class="project-description">
          {{ project.desc }}
        </p>

        <div class="project-info">

          <div class="info-item">
            <img src="/icons/progress.png" />
            <div>
              <small>Project Timeline</small>
              <div>{{ project.timeline }}</div>
            </div>
          </div>

          <div class="info-item">
            <img src="/icons/createdby.png" />
            <div>
              <small>Created By</small>
              <div>{{ project.createdBy }}</div>
            </div>
          </div>

          <div class="info-item">
            <img src="/icons/created.png" />
            <div>
              <small>Created</small>
              <div>{{ project.createdOn }}</div>
            </div>
          </div>

        </div>

      </div>

      <div class="actions">
        <button class="btn green" (click)="openCreateTask()">
          Create New Task
        </button>

        <button class="btn red" (click)="deleteProject()">
          Delete Project
        </button>
      </div>

    </div>

    <div class="progress-section">
      <div class="progress-top">
        <span>Progress</span>
        <span>{{ progressPercentage | number:'1.0-0' }}%</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"
             [style.width.%]="progressPercentage">
        </div>
      </div>
    </div>

    <div class="status-cards">
      <div class="card todo">
        <h4>To Do</h4>
        <h2>{{ todoTasks.length }}</h2>
      </div>

      <div class="card progress">
        <h4>In Progress</h4>
        <h2>{{ inProgressTasks.length }}</h2>
      </div>

      <div class="card completed">
        <h4>Completed</h4>
        <h2>{{ completedTasks.length }}</h2>
      </div>

      <div class="card overdue">
        <h4>Overdue</h4>
        <h2>{{ overdueTasks.length }}</h2>
      </div>
    </div>

  <div class="tasks-wrapper">

  <div class="tasks-header">
    <h3>Tasks</h3>

    <div class="view-toggle">
      <button class="toggle-btn"
              [class.active]="viewMode === 'list'"
              (click)="setView('list')">
        List
      </button>

      <button class="toggle-btn"
              [class.active]="viewMode === 'board'"
              (click)="setView('board')">
        Board
      </button>
    </div>
  </div>

  <div *ngIf="viewMode === 'list'">

    <div class="task-table">

      <div class="table-header">
        <div>Title</div>
        <div>Status</div>
        <div>Priority</div>
        <div>Assignee</div>
        <div>Due Date</div>
      </div>

      <div class="table-row"
           *ngFor="let task of project.tasks">

        <div>{{ task.title }}</div>

        <div>
          <span class="badge"
                [ngClass]="task.status.replace(' ','').toLowerCase()">
            {{ task.status }}
          </span>
        </div>

        <div>
          <span class="badge"
                [ngClass]="task.priority.toLowerCase()">
            {{ task.priority }}
          </span>
        </div>

        <div>{{ task.assignee }}</div>
        <div>{{ task.dueDate }}</div>

      </div>

    </div>

  </div>

  <div *ngIf="viewMode === 'board'" class="board-view">

    <div class="board-column"
         cdkDropList
         (cdkDropListDropped)="drop($event, 'To Do')">

      <h4>To Do ({{ todoTasks.length }})</h4>

      <div class="board-card"
           *ngFor="let task of todoTasks"
           cdkDrag
           [cdkDragData]="task">

        <h5>{{ task.title }}</h5>
        <p>{{ task.assignee }}</p>

        <span class="badge"
              [ngClass]="task.priority.toLowerCase()">
          {{ task.priority }}
        </span>

      </div>
    </div>

    <div class="board-column"
         cdkDropList
         (cdkDropListDropped)="drop($event, 'In Progress')">

      <h4>In Progress ({{ inProgressTasks.length }})</h4>

      <div class="board-card"
           *ngFor="let task of inProgressTasks"
           cdkDrag
           [cdkDragData]="task">

        <h5>{{ task.title }}</h5>
        <p>{{ task.assignee }}</p>

        <span class="badge"
              [ngClass]="task.priority.toLowerCase()">
          {{ task.priority }}
        </span>

      </div>
    </div>

    <div class="board-column"
         cdkDropList
         (cdkDropListDropped)="drop($event, 'Completed')">

      <h4>Completed ({{ completedTasks.length }})</h4>

      <div class="board-card"
           *ngFor="let task of completedTasks"
           cdkDrag
           [cdkDragData]="task">

        <h5>{{ task.title }}</h5>
        <p>{{ task.assignee }}</p>

        <span class="badge"
              [ngClass]="task.priority.toLowerCase()">
          {{ task.priority }}
        </span>

      </div>
    </div>

  </div>



      <ng-template #noTasks>
        <div class="empty-state">
          No tasks available.
        </div>
      </ng-template>

    </div>

  </div>

  
  <div *ngIf="currentPage === 'list'" class="separate-page">
    <h2>Task List</h2>
    <button class="btn outline" (click)="showMain()">Back</button>
  </div>

  <div *ngIf="currentPage === 'board'" class="separate-page">
    <h2>Task Board</h2>
    <button class="btn outline" (click)="showMain()">Back</button>
  </div>

</div>