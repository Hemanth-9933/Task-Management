<div class="container" *ngIf="project">
  
  <div class="view-wrapper" *ngIf="!isCreateTaskMode">
    <div class="breadcrumb">
      Projects / {{ project.title }}
    </div>

    <div class="header">
      <div class="header-left">
        <h1>
          {{ project.title }}
          <span class="badge">{{ project.status }}</span>
        </h1>
        <p class="desc">{{ project.desc }}</p>
      </div>

      <div class="actions">
        <button class="btn-create" (click)="openCreateTask()">Create New Task</button>
        <button class="btn-edit" (click)="editProject()">
          Edit Project <span class="edit-icon">âœŽ</span>
        </button>
        <button class="btn-delete" (click)="deleteProject()">
          Delete Project <span class="delete-icon">ðŸ—‘</span>
        </button>
      </div>
    </div>

    <div class="info-row">
      <div class="info-item">
        <span class="icon">ðŸ“…</span>
        <div>
          <label>Project Timeline</label>
          <strong>{{ project.start | date:'mediumDate' }} - {{ project.end | date:'mediumDate' }}</strong>
        </div>
      </div>
      <div class="info-item">
        <span class="icon">ðŸ‘¥</span>
        <div>
          <label>Created By</label>
          <strong>{{ project.createdBy }}</strong>
        </div>
      </div>
    </div>

    <div class="progress-section">
      <div class="progress-header">
        <span><span class="icon">ðŸ“ˆ</span> Progress</span>
      </div>
      <div class="progress-bar-container">
        <div class="progress-fill" [style.width.%]="progressPercentage"></div>
      </div>
      <small class="progress-label">Day {{ currentDayOfProject }} of {{ totalDaysOfProject }} ({{ progressPercentage | number:'1.0-0' }}%)</small>
    </div>

    <div class="stats">
      <div class="card"><p>To Do</p><h2>{{ toDo }}</h2></div>
      <div class="card blue"><p>In Progress</p><h2>{{ inProgress }}</h2></div>
      <div class="card green"><p>Completed</p><h2>{{ completed }}</h2></div>
      <div class="card red"><p>Overdue</p><h2>{{ overdue }}</h2></div>
    </div>

    <div class="task-section">
      <div class="task-header">
        <h3>Tasks</h3>
        <div class="view-toggle">
          <button class="toggle-btn active">List</button>
          <button class="toggle-btn">Board</button>
          <button class="btn-create-small" (click)="openCreateTask()">Create New Task</button>
        </div>
      </div>

      <div class="task-card" *ngFor="let task of project.tasks">
        <div class="task-main">
          <strong>{{ task.title }}</strong>
          <p class="task-meta">{{ task.dueDate | date:'mediumDate' }} â€¢ Assigned to: {{ task.assignee || project.createdBy }}</p>
        </div>
        <div class="task-status-area">
          <span class="status-pill" [ngClass]="task.status.toLowerCase().replace(' ', '-')">{{ task.status }}</span>
          <span class="priority-pill low">{{ task.priority || 'Low' }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="view-wrapper" *ngIf="isCreateTaskMode">
    <div class="form-header-area">
      <h1 class="page-title">Create Task</h1>
      <p class="page-subtitle">Create your task</p>
    </div>

    <div class="styled-form-card">
      <p class="form-instruction">Add a new task to track progress on your project</p>
      
      <div class="form-grid-layout">
        <div class="field-box">
          <label>Project <span class="req">*</span></label>
          <input type="text" [value]="project.title" disabled class="grey-input disabled-input">
        </div>

        <div class="field-box">
          <label>Title <span class="req">*</span></label>
          <input type="text" [(ngModel)]="newTask.title" placeholder="Enter task title" class="grey-input">
        </div>

        <div class="field-box">
          <label>Status <span class="req">*</span></label>
          <select [(ngModel)]="newTask.status" class="grey-input">
            <option>To Do</option>
            <option>In Progress</option>
            <option>Completed</option>
          </select>
        </div>

        <div class="field-box">
          <label>Priority <span class="req">*</span></label>
          <select [(ngModel)]="newTask.priority" class="grey-input">
            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
          </select>
        </div>

        <div class="field-box wide-field">
          <label>Description</label>
          <textarea [(ngModel)]="newTask.description" placeholder="Enter description (optional)" class="grey-input text-area-input"></textarea>
          <span class="count-label">{{ newTask.description?.length || 0 }}/500</span>
        </div>

        <div class="field-box">
          <label>Assignee <span class="req">*</span></label>
          <select [(ngModel)]="newTask.assignee" class="grey-input">
            <option value="" disabled>Select an assignee</option>
            <option>{{ project.createdBy }}</option>
            <option>Hemanth</option>
            <option>Vinoth</option>
            <option>Dinesh</option>
            <option>Kumar</option>
          </select>
        </div>

        <div class="field-box">
          <label>Due Date <span class="req">*</span></label>
          <input type="date" [(ngModel)]="newTask.dueDate" class="grey-input">
          <small class="hint-text">Project dates: {{ project.start }} â†’ {{ project.end }}</small>
        </div>
      </div>

      <div class="form-action-buttons">
        <button class="btn-olive-submit" (click)="saveCreatedTask()">Create Task</button>
        <button class="btn-round-grey" (click)="resetForm()">Reset</button>
        <button class="btn-round-grey" (click)="isCreateTaskMode = false">Cancel</button>
      </div>
    </div>
  </div>
</div>