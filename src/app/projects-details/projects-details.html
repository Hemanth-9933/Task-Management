<div class="project-container" *ngIf="project">

  <div *ngIf="currentPage === 'createTask'" class="form-page">
    <div class="page-header">
      <h2>Create Task</h2>
    </div>

    <div class="form-card">
      <div class="form-grid">

        <div class="form-group">
          <label>Title *</label>
          <input type="text" [(ngModel)]="newTask.title">
        </div>

        <div class="form-group">
          <label>Status *</label>
          <select [(ngModel)]="newTask.status">
            <option>To Do</option>
            <option>In Progress</option>
            <option>Completed</option>
            <option>Overdue</option>
          </select>
        </div>

        <div class="form-group">
          <label>Priority *</label>
          <select [(ngModel)]="newTask.priority">
            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
            <option>Urgent</option>
          </select>
        </div>

        <div class="form-group">
          <label>Assignee *</label>
          <input type="text" [(ngModel)]="newTask.assignee">
        </div>

        <div class="form-group">
          <label>Due Date *</label>
          <input type="date" [(ngModel)]="newTask.dueDate">
        </div>

        <div class="form-group full">
          <label>Description</label>
          <textarea [(ngModel)]="newTask.description"></textarea>
        </div>

      </div>

      <div class="form-actions">
        <button class="btn green" (click)="saveTask()">Create Task</button>
        <button class="btn outline" (click)="showMain()">Cancel</button>
      </div>
    </div>
  </div>

  <div *ngIf="currentPage === 'editProject'" class="form-page">
    <div class="page-header">
      <h2>Edit Project</h2>
    </div>

    <div class="form-card">
      <div class="form-grid">

        <div class="form-group">
          <label>Project Name *</label>
          <input type="text" [(ngModel)]="project.title">
        </div>

        <div class="form-group">
          <label>Status *</label>
          <select [(ngModel)]="project.status">
            <option>To Do</option>
            <option>In Progress</option>
            <option>Completed</option>
            <option>Overdue</option>
          </select>
        </div>

        <div class="form-group">
          <label>Start Date *</label>
          <input type="date" [(ngModel)]="project.startDate">
        </div>

        <div class="form-group">
          <label>End Date *</label>
          <input type="date" [(ngModel)]="project.endDate">
        </div>

        <div class="form-group full">
          <label>Description</label>
          <textarea [(ngModel)]="project.desc"></textarea>
        </div>

      </div>

      <div class="form-actions">
        <button class="btn green" (click)="saveProject()">Save Changes</button>
        <button class="btn outline" (click)="showMain()">Cancel</button>
      </div>
    </div>
  </div>

<div *ngIf="currentPage === 'main'">

  <div class="breadcrumb">
    Projects / {{ project.title }}
  </div>

  <div class="project-header">

    <div class="header-left">

      <h1 class="project-title">
        {{ project.title }}
        <span class="status-badge"
              [ngClass]="project.status?.replace(' ','').toLowerCase()">
          {{ project.status }}
        </span>
      </h1>

      <p class="project-description">
        {{ project.desc }}
      </p>

      <div class="timeline">
        <div class="timeline-item">
          üìÖ <strong>Project Timeline</strong><br>
          {{ project.startDate }} - {{ project.endDate }}
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-label">
          üìà <strong>Progress</strong>
        </div>

        <div class="progress-bar">
          <div class="progress-fill"
               [style.width.%]="getProgressPercentage()">
          </div>
        </div>

        <div class="progress-text">
          {{ getCompletedCount() }} of {{ project.tasks?.length || 0 }}
          ({{ getProgressPercentage() }}%)
        </div>
      </div>

    </div>

    <div class="actions">
      <button class="btn green" (click)="openCreateTask()">
        Create New Task
      </button>

      <button class="btn outline" (click)="openEditProject()">
        ‚úèÔ∏è Edit Project
      </button>

      <button class="btn red" (click)="deleteProject()">
        üóë Delete Project
      </button>
    </div>

  </div>

  <div class="stats-cards">

    <div class="stat-card todo">
      <p>To Do</p>
      <h2>{{ getStatusCount('To Do') }}</h2>
    </div>

    <div class="stat-card progress">
      <p>In Progress</p>
      <h2>{{ getStatusCount('In Progress') }}</h2>
    </div>

    <div class="stat-card completed">
      <p>Completed</p>
      <h2>{{ getStatusCount('Completed') }}</h2>
    </div>

    <div class="stat-card overdue">
      <p>Overdue</p>
      <h2>{{ getStatusCount('Overdue') }}</h2>
    </div>

  </div>

  <div class="tasks-wrapper">

    <div class="tasks-header">
      <h3>Tasks</h3>

      <div class="view-toggle">
        <button class="toggle-btn" (click)="goToList()">List</button>
        <button class="toggle-btn" (click)="goToBoard()">Board</button>
      </div>
    </div>

    <div class="task-preview"
         *ngFor="let task of project.tasks">

      <div class="task-left">
        <h4>{{ task.title }}</h4>
        <p>
          {{ task.dueDate }} ‚Ä¢ Assigned to: {{ task.assignee }}
        </p>
      </div>

      <div class="task-right">
        <span class="badge"
              [ngClass]="task.status.replace(' ','').toLowerCase()">
          {{ task.status }}
        </span>

        <span class="badge"
              [ngClass]="task.priority.toLowerCase()">
          {{ task.priority }}
        </span>
      </div>

    </div>

  </div>

</div>
  <div *ngIf="currentPage === 'list'" class="separate-page">

    <h2>Task List</h2>
    <button class="btn outline" (click)="showMain()">Back</button>

    <div class="task-table">
      <div class="table-header">
        <div>Title</div>
        <div>Status</div>
        <div>Priority</div>
        <div>Assignee</div>
        <div>Due Date</div>
      </div>

      <div class="table-row"
           *ngFor="let task of project.tasks">

        <div>{{ task.title }}</div>

        <div>
          <span class="badge"
                [ngClass]="task.status.replace(' ','').toLowerCase()">
            {{ task.status }}
          </span>
        </div>

        <div>
          <span class="badge"
                [ngClass]="task.priority.toLowerCase()">
            {{ task.priority }}
          </span>
        </div>

        <div>{{ task.assignee }}</div>
        <div>{{ task.dueDate }}</div>

      </div>
    </div>

  </div>

  <div *ngIf="currentPage === 'board'" class="separate-page">

    <h2>Task Board</h2>
    <button class="btn outline" (click)="showMain()">Back</button>

    <div class="board-view">

      <div class="board-column"
           cdkDropList
           id="todoList"
           [cdkDropListData]="todoTasks"
           [cdkDropListConnectedTo]="['progressList','completedList']"
           (cdkDropListDropped)="drop($event,'To Do')">

        <h4>To Do ({{ todoTasks.length }})</h4>

        <div class="board-card"
             *ngFor="let task of todoTasks"
             cdkDrag
             [cdkDragData]="task">

          <h5>{{ task.title }}</h5>
          <p>{{ task.assignee }}</p>

          <span class="badge"
                [ngClass]="task.priority.toLowerCase()">
            {{ task.priority }}
          </span>
        </div>
      </div>

      <div class="board-column"
           cdkDropList
           id="progressList"
           [cdkDropListData]="inProgressTasks"
           [cdkDropListConnectedTo]="['todoList','completedList']"
           (cdkDropListDropped)="drop($event,'In Progress')">

        <h4>In Progress ({{ inProgressTasks.length }})</h4>

        <div class="board-card"
             *ngFor="let task of inProgressTasks"
             cdkDrag
             [cdkDragData]="task">

          <h5>{{ task.title }}</h5>
          <p>{{ task.assignee }}</p>

          <span class="badge"
                [ngClass]="task.priority.toLowerCase()">
            {{ task.priority }}
          </span>
        </div>
      </div>

      <div class="board-column"
           cdkDropList
           id="completedList"
           [cdkDropListData]="completedTasks"
           [cdkDropListConnectedTo]="['todoList','progressList']"
           (cdkDropListDropped)="drop($event,'Completed')">

        <h4>Completed ({{ completedTasks.length }})</h4>

        <div class="board-card"
             *ngFor="let task of completedTasks"
             cdkDrag
             [cdkDragData]="task">

          <h5>{{ task.title }}</h5>
          <p>{{ task.assignee }}</p>

          <span class="badge"
                [ngClass]="task.priority.toLowerCase()">
            {{ task.priority }}
          </span>
        </div>
      </div>

    </div>

  </div>

</div>