<div class="tasks-container">

   

<div class="tasks-container">

  <div class="header">
    <h2>All Tasks</h2>

    <div class="header-actions">
      <button class="filter-btn" (click)="showFilters = true">
        Filters
      </button>

      <button class="create-btn" (click)="toggleCreateTaskForm()">
        Create New Task
      </button>
    </div>
  </div>


  <div *ngIf="showFilters" class="filter-overlay" (click)="showFilters = false">

    <div class="filter-panel" (click)="$event.stopPropagation()">

      <div class="filter-card">
        <div class="card-header">
          <span>Status</span>
          <button (click)="statusFilter = ''; applyFilters()">Clear</button>
        </div>

        <label><input type="checkbox" value="To Do" (change)="onStatusChange($event)"> To Do</label>
        <label><input type="checkbox" value="In Progress" (change)="onStatusChange($event)"> In Progress</label>
        <label><input type="checkbox" value="Done" (change)="onStatusChange($event)"> Completed</label>
        <label><input type="checkbox" value="On Hold" (change)="onStatusChange($event)"> On Hold</label>
      </div>

      <div class="filter-card">
        <div class="card-header">
          <span>Priority</span>
          <button (click)="priorityFilter = ''; applyFilters()">Clear</button>
        </div>

        <label><input type="checkbox" value="low" (change)="onPriorityChange($event)"> Low</label>
        <label><input type="checkbox" value="medium" (change)="onPriorityChange($event)"> Medium</label>
        <label><input type="checkbox" value="high" (change)="onPriorityChange($event)"> High</label>
        <label><input type="checkbox" value="urgent" (change)="onPriorityChange($event)"> Urgent</label>
      </div>

      <!-- ASSIGNEE -->
      <div class="filter-card">
        <div class="card-header">
          <span>Assignee</span>
          <button (click)="assignedFilter = ''; applyFilters()">Clear</button>
        </div>

        <label><input type="checkbox" value="Hemanth" (change)="onAssignedChange($event)"> Hemanth</label>
        <label><input type="checkbox" value="Vinoth" (change)="onAssignedChange($event)"> Vinoth</label>
        <label><input type="checkbox" value="Dinesh" (change)="onAssignedChange($event)"> Dinesh</label>
        <label><input type="checkbox" value="Shivam" (change)="onAssignedChange($event)"> Shivam</label>
      </div>

      <!-- CLEAR ALL -->
      <div class="clear-all">
        <button (click)="clearAllFilters()">Clear All Filters</button>
      </div>

    </div>
  </div>

  <div *ngIf="showCreateTaskForm" class="form-card">
    <h3>Create New Task</h3>

    <form (ngSubmit)="createTask()">

      <input type="text"
             [(ngModel)]="newTask.title"
             name="title"
             placeholder="Title"
             required>

      <textarea
        [(ngModel)]="newTask.description"
        name="description"
        placeholder="Description">
      </textarea>

      <select [(ngModel)]="newTask.status" name="status">
        <option>To Do</option>
        <option>In Progress</option>
        <option>Done</option>
        <option>On Hold</option>
      </select>

      <select [(ngModel)]="newTask.priority" name="priority">
        <option>low</option>
        <option>medium</option>
        <option>high</option>
        <option>urgent</option>
      </select>

      <input type="text"
             [(ngModel)]="newTask.assigned"
             name="assigned"
             placeholder="Assign to">

      <input type="date"
             [(ngModel)]="newTask.dueDate"
             name="dueDate">

      <select [(ngModel)]="newTask.projectId" name="projectId" required>
        <option [ngValue]="null">Select Project</option>
        <option *ngFor="let p of projects" [ngValue]="p.id">
          {{ p.title }}
        </option>
      </select>

      <div class="form-buttons">
        <button type="submit" class="save-btn">Create</button>
        <button type="button" class="cancel-btn" (click)="toggleCreateTaskForm()">Cancel</button>
      </div>

    </form>
  </div>

  <div *ngIf="editingTask" class="form-card">
    <h3>Edit Task</h3>

    <form (ngSubmit)="saveEditedTask()">

      <input type="text"
             [(ngModel)]="editTaskForm.title"
             name="editTitle"
             required>

      <textarea
        [(ngModel)]="editTaskForm.description"
        name="editDescription">
      </textarea>

      <select [(ngModel)]="editTaskForm.status" name="editStatus">
        <option>To Do</option>
        <option>In Progress</option>
        <option>Done</option>
        <option>On Hold</option>
      </select>

      <select [(ngModel)]="editTaskForm.priority" name="editPriority">
        <option>low</option>
        <option>medium</option>
        <option>high</option>
        <option>urgent</option>
      </select>

      <input type="text"
             [(ngModel)]="editTaskForm.assigned"
             name="editAssigned">

      <input type="date"
             [(ngModel)]="editTaskForm.dueDate"
             name="editDueDate">

      <div class="form-buttons">
        <button type="submit" class="save-btn">Save</button>
        <button type="button" class="cancel-btn" (click)="cancelEdit()">Cancel</button>
      </div>

    </form>
  </div>

  <table *ngIf="filteredTasks.length">
    <thead>
      <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Priority</th>
        <th>Assignee</th>
        <th>Due Date</th>
        <th>Project</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
<tr *ngFor="let t of filteredTasks"
    (click)="viewTask(t)"
    class="task-row">

        <td class="title">{{ t.title }}</td>

        <td>
          <span class="badge"
                [ngClass]="{
                  'status-done': t.status === 'Done',
                  'status-progress': t.status === 'In Progress',
                  'status-todo': t.status === 'To Do',
                  'status-hold': t.status === 'On Hold'
                }">
            {{ t.status }}
          </span>
        </td>

        <td>
          <span class="badge"
                [ngClass]="{
                  'priority-low': t.priority === 'low',
                  'priority-medium': t.priority === 'medium',
                  'priority-high': t.priority === 'high',
                  'priority-urgent': t.priority === 'urgent'
                }">
            {{ t.priority | titlecase }}
          </span>
        </td>

        <td class="assignee">
          <div class="avatar">
            {{ t.assigned ? (t.assigned[0] | uppercase) : '' }}
          </div>
          {{ t.assigned }}
        </td>

        <td>{{ t.dueDate }}</td>
        <td>{{ t.projectTitle }}</td>

        <td class="actions">
          <span class="edit" (click)="updateTask(t)">‚úèÔ∏è</span>
          <!-- <span class="delete" (click)="deleteTask(t)">üóëÔ∏è</span> -->
          <img src="/icons/delete.png" class="delete" (click)="deleteTask(t)">
        </td>

      </tr>
    </tbody>
  </table>

  <p *ngIf="!filteredTasks.length" class="no-tasks">
    No tasks found
  </p>

</div>
<div *ngIf="selectedTask" class="modal-overlay" (click)="closeTaskDetails()">

  <div class="modal-content" (click)="$event.stopPropagation()">

    <div class="modal-header">
      <h3>{{ selectedTask.title }}</h3>
      <button class="close-btn" (click)="closeTaskDetails()">‚úï</button>
    </div>

    <div class="modal-body">

      <div class="badge-row">
        <span class="badge"
              [ngClass]="{
                'status-done': selectedTask.status === 'Done',
                'status-progress': selectedTask.status === 'In Progress',
                'status-todo': selectedTask.status === 'To Do',
                'status-hold': selectedTask.status === 'On Hold'
              }">
          {{ selectedTask.status }}
        </span>

        <span class="badge"
              [ngClass]="{
                'priority-low': selectedTask.priority === 'low',
                'priority-medium': selectedTask.priority === 'medium',
                'priority-high': selectedTask.priority === 'high',
                'priority-urgent': selectedTask.priority === 'urgent'
              }">
          {{ selectedTask.priority | titlecase }}
        </span>
      </div>

      <p><strong>Assigned:</strong> {{ selectedTask.assigned }}</p>
      <p><strong>Due Date:</strong> {{ selectedTask.dueDate }}</p>
      <p><strong>Project:</strong> {{ selectedTask.projectTitle }}</p>
      <p><strong>Description:</strong> {{ selectedTask.description }}</p>

    </div>

  </div>
</div>

